<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		
		<script src="js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/mui.picker.min.js" type="text/javascript" charset="utf-8"></script>
		
		<link rel="stylesheet" type="text/css" href="css/mui.picker.min.css"/>
		
		<style>
		  body{
		  	margin:0;
		  	padding:0;
		  }
			.iback {
				background: no-repeat center center url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABYCAYAAAADWlKCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAKwwAACsMBNCkkqwAAABZ0RVh0Q3JlYXRpb24gVGltZQAwOS8xMi8xM5w+I3MAAAAcdEVYdFNvZnR3YXJlAEFkb2JlIEZpcmV3b3JrcyBDUzVxteM2AAACcklEQVR4nO3a0XESURiG4TeO99iBWoGZ+RvADtKBpAPtwBLsANJBrEAs4MyYDmIHSQXkgk0mMLK7ILt8/+F778ici394OGfDsher1Qqn05tTD+A2M4hYBhHLIGIZRCyDiGUQsQwilkHEMohYBhHLIGIZRCyDiGUQsQwilkHEMohYBhHLIGIZRCyDiGUQsQwilkHEMohYb089wNCVUq6Ay+blfUQsTjhOZxc1P9tbSlkAX7b+/C0ifpxgnF5Ve2TtwAD4OvIoe1UlSAsGwPsRR9m76kA6MAD+jjTKQVUF0gMD4HaEUQ6umot6T4ybiJgNP83hVbFDasGACnZIT4yfEXE1wjj/Xeod0hPjDpgNPsyRSguyB8Y0Ih6Gn+g4pQSpFQMSgtSMAclAaseARCDngAFJQM4FAxKAnBMGiH8xLKVMgV89ln6MiPthpxkn6R0SEUvgusfSZSnlsnuZftI75LlSygyYdyx7ZH1s/Rl+ouFKAQIvx9ctMGlZlh4lDQhAcywtqRhF+hqyXfMmT1m/6buasL6mzMaY6dilAoENlLuWZRNgnhEl1ZH1ulLKO9bH16eOpdfqz2K9Lt0Oea75EjilfadAsp2SFgQ2UH53LJ2XUr4PPtARSntkbVfL7+rVgEBvlM/NHQDJUh9Z2zWf/puOZbPhJzm8qkDgBaXt/teHcSY5rOpAAJp/c/vclJSrShDYifKI+NPvVV3U/1VzU3LavFyo/25SPUi2qj2ysmYQsQwilkHEMohYBhHLIGIZRCyDiGUQsQwilkHEMohYBhHLIGIZRCyDiGUQsQwilkHEMohYBhHLIGIZRCyDiGUQsZ4Ak9fPFwUy/HsAAAAASUVORK5CYII=);
				background-size: 50px 44px;
			}
			
			.nvbt {
				width: 15%;
				height: 15px;
				//float:left;
				overflow: hidden;
				text-overflow: ellipsis;
				white-space: nowrap;
				position: absolute;
				top: 12px;
			}
			
			.head {
				color: #A6A6AB;
				height: 25px;
				border-bottom: #ccc 1px solid;
				margin-bottom: 10px;
				padding-top: 10px;
				text-align: center;
				width: 100%;
				position:fixed;
				top:0;
				background-color: white;
				//position: static;
				z-index: 10;
			}
			
			input {
				
				height: 30px;
				font-size:15px;
				outline: none;
				border: none;
				//border:1px solid #C0C0C0;
				position: absolute;
				top: 5px;
				left: 50px;
				background: transparent;
				-webkit-tap-highlight-color: rgba(0, 0, 0, 0);
			}
			#panel{
				//margin-top:50px;
			border:1px solid #ccc;
			border-radius: 10px;
			padding:0 0 15px 0px;
			width:95%;
			margin: auto;
			margin-top:50px;
			}
			li{
				list-style-type: none;
				position: relative;
				//height:45px;
				padding:20px auto;
				line-height: 50px;
				border-bottom:1px solid #ccc;
				margin-bottom:5px;
				margin-left: 5px;
			}
			.right{
				//float:right;
				position:absolute;
				right:5px;
				top:10px;
			}
			.reserve-date button{
				
				//top:12px;
			}
			select{
				
				top:17px;
			}
			.submit{
				margin:10px;
				text-align: center;
				padding:15px;
				border-radius: 5px;
				background: #0DD9F3;
			}
		</style>
	</head>
	<body>
	  <div class='head'>预约加油
			<div class='nvbt iback'></div>
		</div>
		
		<ul id='panel'>
			<li><span>姓名:</span><input type="text" name="" id="username" value="" /></li>
			<li class='bus'>汽车:
				<select class='buspicker right' id="carList">
					
					
				</select>
			</li>
			<li class='reserve-date'><span id="date" class='reserve-date-span'>今天</span><button id='pick-date' data-options='{"type":"date","beginYear":2016,"endYear":2017}' class="right">选择日期</button></li>
		    <li class='gasstation'></li>
		    <li class='gastype'>类型:
		    	<select name="" class='right' style=''>
		    	<option value="90">90#</option>
		    	<option value="92">92#</option>
		    	<option value="93">93#</option>
		    	<option value="95">95#</option>
		    	<option value="97">97#</option>
		    	<option value="0">0#</option>
		        </select>
		    </li>
		    <li class='gasamount'>加油量:<input type="" name="" id="gasamount" value="" placeholder=""/>
		    	<select name="" class='right' style=''>
		    		<option value="升">升</option>
		    		<option value='元'>元</option>
		    	</select>
		    </li>
		
		</ul>
		<div class='submit'>提交订单</div>
	<script>
	
	function showSelect (cars) {
	//alert("showselected");
	var sel = document.querySelector(".buspicker.right");
	
	for(var i in cars){
		console.log(JSON.stringify(cars[i]));
		var opt=document.createElement('option');
		opt.value=cars[i].hphm;
		console.log(cars[i].hphm)
		opt.innerHTML=cars[i].brand+" "+cars[i].hphm;
		sel.appendChild(opt);
	}
}
			(function($) {
				$.init();
				//20160514
				mui.plusReady(
					function(){
						var self=plus.webview.currentWebview();
						var gasStation=document.querySelector('.gasstation');
						gasStation.innerText=self.name;
						/*var self = plus.webview.currentWebview();
						document.querySelector('.gasstation').innerHTML=self.json.name;*/
						document.querySelector('.submit').addEventListener('tap',
						function(){
							var gasOrder;
							var gasstation=document.querySelector('.gasstation').innerHTML;
							var username=document.getElementById('username').value;
							var theDate=document.getElementById('date').innerText;
							var carSelect=document.getElementsByClassName('buspicker right')[0];
							var carIndex=carSelect.selectedIndex;
							var car=carSelect.children[carIndex].innerText;
							
							var gasTypeSelect=document.getElementsByClassName('right')[2];
							var gasTypeIndex=gasTypeSelect.selectedIndex;
							var gasType=gasTypeSelect.children[gasTypeIndex].value;
							
							var amountSelect=document.getElementsByClassName('right')[3];
							var amountIndex=amountSelect.selectedIndex;
							var amount=document.getElementById('gasamount').value+amountSelect.children[amountIndex].value;
							
							var oj={},myd=new Date();
							oj.name=username;
							oj.carDesc=car;
							oj.date=(theDate=="今天")?myd.getFullYear()+"-"+(myd.getMonth()+1)+"-"+myd.getDate():theDate;
							
							console.log(oj.date);
							oj.gasStation=gasstation;
							oj.type=gasType+"#";
							oj.volume=amount;
							
							gasOrder= car + theDate + gasstation + gasType + ',' + amount;
							console.log(JSON.stringify(oj));
							mui.openWindow({url:"createBarcode.html",id:"createBarcode.html",extras:{json:gasOrder}})
						}
						,false);
						
						
						//car
						var carArr=[];
						(function queryCars() {
							//alert("querycars");
							//var postUrl = "http://192.168.1.108:8080/IOVServer/carDbServlet";
							var username=plus.storage.getItem("username");
							//username="zzj";
							console.log(username);
					        var serverUrl=plus.storage.getItem("serverUrl");
					        var postUrl=serverUrl+"carDbServlet"+"?username="+username;
					         console.log(postUrl);
							var request = new plus.net.XMLHttpRequest();
							//XMLHttpRequest();
					
							request.open("POST", postUrl);
							request.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
							request.send();
					        var wd = plus.nativeUI.showWaiting("正在获取您的车辆...");
					       // plus.nativeUI.toast("");
							request.onreadystatechange = function() {
								//alert(request.readyState);
								if (request.readyState == 4) {
									wd.close();
									if (request.status == 200) {
										console.log("querycars" + request.responseText);
					                    
										var res = JSON.parse(request.responseText);
										var cars = res.data;
										var len = cars.length;
										for (var i in cars) {
											carArr.push(cars[i]);
										}
										
					                   showSelect (carArr);
									} else {
										alert("querycars" + "发生错误" + request.status);
									}
								}
							}
					
						})()
						var carOptionList=document.getElementById("carList");
						for(var i in carArr){
							var options=document.createElement('option');
							options.innerText=carArr[i];
							carOptionList.appendChild(options);
						}
						
					}
				)
				//
				var btn = document.querySelector('#pick-date');
				
					btn.addEventListener('tap', function() {
						var optionsJson = this.getAttribute('data-options') || '{}';
						var options = JSON.parse(optionsJson);
						
						var picker = new $.DtPicker(options);
						picker.show(function(rs) {
							
							document.querySelector('.reserve-date-span').innerText = rs.text;
							
							//picker.dispose();
						});
					}, false);
				//picker.dispose();
			})(mui);
		
		</script>
		<script src="js/back.js" type="text/javascript" charset="utf-8"></script>
	</body>
</html>
